{"componentChunkName":"component---src-pages-wfquickstart-js","path":"/wfquickstart/","result":{"data":{"markdownRemark":{"html":"<h1>EPI2ME Labs Workflows Quick Start Guide</h1>\n<p>EPI2ME Labs workflow are built using the <a href=\"https://www.nextflow.io/\">nextflow</a> workflow\nframework:</p>\n<blockquote>\n<p><em>Nextflow enables scalable and reproducible scientific workflows using\nsoftware containers. It allows the adaptation of pipelines written in the most\ncommon scripting languages.</em></p>\n<p><em>Its fluent DSL simplifies the implementation and the deployment of complex\nparallel and reactive workflows on clouds and clusters.</em></p>\n</blockquote>\n<h2>Installation</h2>\n<p>EPI2ME Labs workflows can currently be run using either\n<a href=\"https://www.docker.com/products/docker-desktop\">Docker</a> or\n<a href=\"https://docs.conda.io/en/latest/miniconda.html\">conda</a> to provide isolation of\nthe required software. Both methods are automated out-of-the-box provided\neither docker of conda is installed.</p>\n<p>In the future we hope to provide support for the <a href=\"https://sylabs.io/docs/\">Singularity</a>\ncontainer platform.</p>\n<h3>Nextflow and Docker installation on GridION and PromethION devices</h3>\n<p>Installation of the software on Oxford Nanopore Technologiesâ€™ sequencing device\ncan be performed using the command:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo apt install ont-nextflow</code></pre></div>\n<p>This will install a <a href=\"https://openjdk.java.net/\">Java runtime</a>, Nextflow, and\nDocker. If docker has not already been configured the command below can be\nused to provide user access to the docker services. Please logout of your\ncomputer after this command has been typed.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo usermod -aG docker $USER</code></pre></div>\n<h3>Installation on Ubuntu devices</h3>\n<p>For hardware running Ubuntu the following instructions should suffice to install\nNextflow and Docker in order to run the workflow.</p>\n<ol>\n<li>\n<p>Install a Jva runtime environment (JRE):</p>\n<p><code class=\"language-text\">sudo apt install default-jre</code></p>\n</li>\n<li>\n<p>Download and install Nextflow may be downloaded from <a href=\"https://www.nextflow.io\">https://www.nextflow.io</a>:</p>\n<p><code class=\"language-text\">curl -s https://get.nextflow.io | bash</code></p>\n<p>This will place a <code class=\"language-text\">nextflow</code> binary in the current working directory, you\nmay wish to move this to a location where it is always accessible, e.g:</p>\n<p><code class=\"language-text\">sudo mv nextflow /usr/local/bin</code></p>\n</li>\n<li>\n<p>Install docker and add the current user to the docker group to enable access:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo apt install docker.io\nsudo usermod -aG docker $USER</code></pre></div>\n</li>\n</ol>\n<h2>Generic Workflow instructions</h2>\n<p>The code behind all EPI2ME Labs workflows is hosted publically on our Github\nspace: <a href=\"https://github.com/epi2me-labs/\">https://github.com/epi2me-labs/</a>. Workflow projects are prefixed with <code class=\"language-text\">wf-</code>.\nFor example the code powering our <a href=\"https://github.com/artic-network/fieldbioinformatics\">ARTIC</a>-based\nSARS-CoV-2 analysis is available at: <a href=\"https://github.com/epi2me-labs/wf-artic\">https://github.com/epi2me-labs/wf-artic</a>.</p>\n<p>For the most part, users will not need to interact directly with the Github\ncode repositories as Nextflow has the ability to automatically manage\nworkflows available on Github. </p>\n<p><strong><em>The instructions below are provided using <a href=\"https://github.com/epi2me-labs/wf-artic\">wf-artic</a> as an examplar workflow,\nfor other workflow simple replace <code class=\"language-text\">wf-artic</code> with <code class=\"language-text\">wf-name-of-workflow</code>.</em></strong></p>\n<h3>Downloading and Running Workflows</h3>\n<p>With the prerequisites installed, users can run:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">nextflow run epi2me-labs/wf-artic --help</code></pre></div>\n<p>to see the options for a specific workflow. The help message will display all\ncommon options available for augmenting the workflows behaviour. See\n<em>Configuration and tuning</em> below for information regarding manipulating\nhow workflows are run.</p>\n<p>To run the workflow using Docker containers supply the <code class=\"language-text\">-profile standard</code>\nargument to <code class=\"language-text\">nextflow run</code>:</p>\n<p><em>The command below uses test data available from the <a href=\"https://github.com/epi2me-labs/wf-artic/tree/master/test_data\">github repository</a>\nIt can be obtained with <code class=\"language-text\">git clone https://github.com/epi2me-labs/wf-artic</code>.</em></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># run the pipeline with the test data\nOUTPUT=my_artic_output\nnextflow run epi2me-labs/wf-artic \\\n    -w ${OUTPUT}/workspace\n    -profile standard\n    --fastq test_data/sars-samples-demultiplexed/\n    --samples test_data/sample_sheet \\\n    --out_dir ${OUTPUT}</code></pre></div>\n<h3>Running the workflow with Conda</h3>\n<p>To run the workflow using conda rather than docker, simply replace </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">-profile standard </code></pre></div>\n<p>with</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">-profile conda</code></pre></div>\n<p>in the command above.</p>\n<h3>Configuration and tuning</h3>\n<blockquote>\n<p>This section provides some minimal guidance for changing common options, see\nthe <a href=\"https://www.nextflow.io/docs/latest/config.html\">Nextflow documentation</a> for further details.</p>\n</blockquote>\n<p>The default settings for the workflow are described in the configuration file <code class=\"language-text\">nextflow.config</code>\nfound within the git repository. The default configuration defines an <em>executor</em> that will\nuse a specified maximum CPU cores (four at the time of writing) and RAM (eight gigabytes).</p>\n<p>If the workflow is being run on a device other than a GridION, the available memory and\nnumber of CPUs may be adjusted to the available number of CPU cores. This can be done by\ncreating a file <code class=\"language-text\">my_config.cfg</code> in the working directory with the following contents:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">executor {\n    $local {\n        cpus = 4\n        memory = &quot;8 GB&quot;\n    }\n}</code></pre></div>\n<p>and running the workflow providing the <code class=\"language-text\">-c</code> (config) option, e.g.:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># run the pipeline with custom configuration\nnextflow run epi2me-labs/wf-artic \\\n    -c my_config.cfg \\\n    ...</code></pre></div>\n<p>The contents of the <code class=\"language-text\">my_config.cfg</code> file will override the contents of the default\nconfiguration file. See the <a href=\"https://www.nextflow.io/docs/latest/config.html\">Nextflow documentation</a>\nfor more information concerning customized configuration.</p>\n<p><strong>Using a fixed conda environment</strong></p>\n<p>By default, Nextflow will attempt to create a fresh conda environment for any new\nanalysis (for reasons of reproducibility). This may be undesirable if many analyses\nare being run. To avoid the situation a fixed conda environment can be used for all\nanalyses by creating a custom config with the following stanza:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">profiles {\n    // profile using conda environments rather than docker\n    // containers\n    fixed_conda {\n        docker {\n            enabled = false\n        }\n        process {\n            withLabel:artic {\n                conda = &quot;/path/to/my/conda/environment&quot;\n            }\n            shell = [&#39;/bin/bash&#39;, &#39;-euo&#39;, &#39;pipefail&#39;]\n        }\n    }\n}</code></pre></div>\n<p>and running nextflow by setting the profile to <code class=\"language-text\">fixed_conda</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">nextflow run epi2me-labs/wf-artic \\\n    -c my_config.cfg \\\n    -profile fixed_conda \\\n    ...</code></pre></div>\n<h3>Updating workflows</h3>\n<p>Periodically when running workflows, users may find that a message is displayed\nindicating that an update to the workflow is available.</p>\n<p>To update the workflow simply run (for e.g. the <code class=\"language-text\">wf-artic</code> workflow):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">nextflow pull epi2me-labs/wf-artic</code></pre></div>\n<h2>Building the docker container from source</h2>\n<p>The docker images used for running the EPI2ME Labs workflows are available on\n<a href=\"https://hub.docker.com/repository/docker/ontresearch/\">dockerhub</a>.\nThe image is built from the Dockerfile present in the git repository. Users\nwishing to modify and build the image can do so with:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">CONTAINER_TAG=ontresearch/wf-artic:latest\n\ngit clone https://github.com/epi2me-labs/wf-artic\ncd wf-artic\n\ndocker build \\\n    -t ${CONTAINER_TAG} -f Dockerfile \\\n    --build-arg BASEIMAGE=ontresearch/base-workflow-image:v0.1.0 \\\n    .</code></pre></div>\n<p>In order to run the workflow with this new image it is required to give\n<code class=\"language-text\">nextflow</code> the <code class=\"language-text\">--wfversion</code> parameter:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">nextflow run epi2me-labs/wf-artic \\\n    --wfversion latest</code></pre></div>\n<h2>Useful links</h2>\n<ul>\n<li><a href=\"https://www.nextflow.io/\">nextflow</a> The workflow management system used by EPI2ME Labs workflows.</li>\n<li><a href=\"https://www.docker.com/products/docker-desktop\">docker</a> A software container platform that can be optionally used by EPI2ME Labs.</li>\n<li><a href=\"https://docs.conda.io/en/latest/miniconda.html\">conda</a> A software package manager that can be optionally used by workflows.</li>\n</ul>"},"site":{"siteMetadata":{"title":"EPI2MELabs"}}},"pageContext":{}},"staticQueryHashes":["1462070832","240262808","2841359383"]}